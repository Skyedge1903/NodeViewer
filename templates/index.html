<!-- templates/index.html -->
<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ethereum Node Viewer</title>

    <!-- Bootstrap & Chart.js -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Style global -->
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: "Courier New", monospace;
        }

        h1, h2 {
            color: #fff;
        }

        /* Tabs */
        .nav-tabs {
            border-bottom: 1px solid #333;
        }

        .nav-tabs .nav-link {
            color: #bbb;
            background: #111;
            border: 1px solid #222;
        }

        .nav-tabs .nav-link.active {
            color: #fff;
            background: #222;
            border-color: #444;
        }

        .tab-pane {
            padding: 30px 20px;
        }

        /* Charts */
        .chart-container {
            max-width: 420px;
            margin: 0 auto;
        }

        /* Validator circles */
        .circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-block;
        }

        /* Code-like text */
        pre {
            background: transparent;
            border: none;
            color: inherit;
            font-size: 1.2rem;
        }

        /* Asset colors */
        .asset-cyan { color: cyan; }
        .asset-orange { color: orange; }
        .asset-magenta { color: magenta; }
        .asset-blue { color: dodgerblue; }
        .asset-red { color: red; }

        @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
}

.blink-active {
    animation: blink 1.5s infinite;
}

    </style>
</head>

<body>
<div class="container py-4">

    <h1 class="text-center mb-4">Ethereum Node Viewer</h1>

    <!-- Tabs navigation -->
    <ul class="nav nav-tabs justify-content-center mb-4" id="pagesTab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-total">
                Total Value
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-validator">
                Validator
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-income">
                Passive Income
            </button>
        </li>
    </ul>

    <!-- Tabs content -->
    <div class="tab-content">

        <!-- ================= PAGE 1 : TOTAL VALUE ================= -->
        <div class="tab-pane fade show active" id="tab-total">

            <h2 class="text-center mb-3">Total Value</h2>
            <pre class="text-center text-success fs-3">{{ total_str }}</pre>

            <div class="row mt-4 align-items-center">
                <div class="col-md-6">
                    <ul class="list-group list-group-flush">
                        {% for label in asset_labels %}
                        <li class="list-group-item fs-5" style="background-color: #000; border: 0px solid #222; border-radius:0px; margin-bottom:5px;">
                            <span class="
                                {% if loop.index0 == 0 %}asset-cyan
                                {% elif loop.index0 == 1 %}asset-orange
                                {% elif loop.index0 == 2 %}asset-magenta
                                {% elif loop.index0 == 3 %}asset-blue
                                {% else %}asset-red{% endif %}
                            ">
                                ● {{ label }}
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="col-md-6 chart-container">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
        </div>

<!-- ================= PAGE 2 : VALIDATOR ================= -->
<div class="tab-pane fade" id="tab-validator">

    <h2 class="text-center text-white mb-4">
        Validator {{ validator }}
    </h2>

    <!-- Circles -->
    <div class="d-flex justify-content-center align-items-center my-5 gap-5">

        <div class="text-center">
            <div class="circle bg-success"></div>
            <div class="text-info mt-2">Deposited</div>
        </div>

        <div class="text-center">
            <div class="circle bg-secondary"></div>
            <div class="text-info mt-2">Pending</div>
        </div>

        <div class="text-center">
            <div class="circle bg-{% if active %}success{% else %}danger{% endif %}
                 {% if active %}blink-active{% endif %}">
            </div>
            <div class="text-info mt-2">Active</div>
        </div>

        <div class="text-center">
            <div class="circle bg-secondary"></div>
            <div class="text-info mt-2">Exited</div>
        </div>

    </div>

    <!-- Stats table -->
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <table class="table table-dark table-borderless" style="background-color: #000; border: 0px solid #222; border-radius:0px; margin-bottom:5px;">
                <tbody>
                    <tr>
                        <td class="text-secondary">Rank {{ rank_pct }}%</td>
                        <td class="text-secondary">Balance</td>
                    </tr>
                    <tr>
                        <td class="text-primary">{{ rank }}</td>
                        <td class="text-primary">{{ "%.8f"|format(balance) }}</td>
                    </tr>
                    <tr>
                        <td class="text-secondary">Status</td>
                        <td class="text-secondary">Effectiveness</td>
                    </tr>
                    <tr>
                        <td class="text-success">{{ status }}</td>
                        <td class="text-success">{{ effectiveness }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

        <!-- ================= PAGE 3 : PASSIVE INCOME ================= -->
        <div class="tab-pane fade" id="tab-income">

            <h2 class="text-center mb-4">Passive Income</h2>

            <div class="row align-items-center">
                <div class="col-md-6">
                    <pre class="fs-4">
Day
<span class="text-success">{{ day_eth_str }}</span>
<span class="text-info">{{ day_usdc_str }}</span>

Month
<span class="text-success">{{ month_eth_str }}</span>
<span class="text-info">{{ month_usdc_str }}</span>
                    </pre>
                </div>

                <div class="col-md-6 chart-container">
                    <canvas id="barChart"></canvas>
                </div>
            </div>
        </div>

    </div>

    <div class="text-center mt-5 text-secondary">
        by Skyedge1903 – données mises à jour automatiquement
    </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ================= PIE CHART ================= */
const pieCtx = document.getElementById("pieChart");
if (pieCtx) {
    new Chart(pieCtx, {
        type: "doughnut",
        data: {
            labels: {{ asset_labels | tojson }},
            datasets: [{
                data: {{ asset_values | tojson }},
                backgroundColor: ["cyan", "orange", "magenta", "dodgerblue", "red", "green"],
                borderColor: "#000",
                borderWidth: 2
            }]
        },
        options: {
            cutout: "65%",
            plugins: { legend: { display: false } },
            responsive: true
        }
    });
}

/* ================= BAR CHART ================= */
const barCtx = document.getElementById("barChart");
if (barCtx) {
    new Chart(barCtx, {
        type: "bar",
        data: {
            labels: Array({{ graph_heights|length }}).fill(""),
            datasets: [{
                data: {{ graph_heights | tojson }},
                backgroundColor: "cyan"
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true, max: 100, display: false },
                x: { display: false }
            },
            plugins: { legend: { display: false } },
            responsive: true
        }
    });
}

/* Auto-refresh 20 min */
setTimeout(() => location.reload(), 1200000);
</script>

</body>
</html>